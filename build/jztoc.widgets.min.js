/*
 * jztoc UI Widgets
 *
 * Copyright 2011, Acatl Pacheco
 * Licensed under the MIT License.
 *
 */
 
 
 $.ui.uicomponent.subclass("ui.list",{options:{dataProvider:[],itemRenderer:null,labelFunction:null,labelField:null,itemRendererOptions:null,styleFunction:null,rowFunction:null,loading:{label:"loading..",imageUrl:""},selectedClass:"selected"},_create:function(){this.element.addClass("ui-list")},_init:function(){this.options.dataProvider!=null&&this.dataProvider(this.options.dataProvider)},dataProvider:function(a){this.options.dataProvider=a;this.element.children().remove();for(var b in a){var c=a[b],
e=$("<div></div>").appendTo(this.element),d=this._assignlabelData(c);if(this.options.itemRenderer!=null){var f={data:d,listData:{owner:this,data:c,index:Number(b)}};this.options.itemRendererOptions!=null&&jQuery.extend(f,this.options.itemRendererOptions);e[this.options.itemRenderer](f)}else e.html(d);typeof d=="string"&&this.options.showToolTip==true&&e.attr("title",d);e.addClass("row");this.options.styleFunction!=null&&this.options.styleFunction(e,b,c,this.options);this.options.rowFunction!=null&&
this.options.rowFunction(tr,b,c)}this.element.children().click($.proxy(this._child_clickHandler,this))},selectedIndex:function(a){this.element.children().removeClass(this.options.selectedClass);this.element.children().eq(a).addClass(this.options.selectedClass)},_child_clickHandler:function(a){a.stopPropagation();this.element.children().removeClass(this.options.selectedClass);$(a.currentTarget).addClass(this.options.selectedClass);var b=jQuery.Event("itemclick.list");b.selectedIndex=$(a.currentTarget).index();
this.element.trigger(b)},_assignlabelData:function(a){if(this.options.labelFunction!=null)return this.options.labelFunction(a);if(this.options.labelField!=null)return a[this.options.labelField];if(typeof a=="object")return a.label;return a},showLoading:function(){this.element.children().hide();if(this.options.loading.label!="")$("<div></div>").attr("id","list-loading-text").appendTo(this.element).html(this.options.loading.label);else this.options.loading.imageUrl!=""&&this.element.css({"background-image":"url("+
this.options.loading.imageUrl+")","background-repeat":"no-repeat","background-position":"center center"})},hideLoading:function(){if(this.options.loading.label!="")$("#list-loading-text",this.element).remove();else this.options.loading.imageUrl!=""&&this.element.css({"background-image":"","background-repeat":"","background-position":""});this.element.children().show()},destroy:function(){this.element.children().remove()},_setOption:function(a,b){switch(a){case "dataProvider":this.dataProvider(b)}$.Widget.prototype._setOption.apply(this,
arguments)}});
$.ui.uicomponent.subclass("ui.grid",{options:{dataProvider:null,columns:[],rowFunction:null},_create:function(){this.element.addClass("ui-grid");if(this.options.id==null||this.options.id=="")this.options.id=this._guid();this.elements.table=$("<table></table>").attr("id",this.options.id).addClass("grid").appendTo(this.element);this.elements.tableHead=$("<thead></thead>").appendTo(this.elements.table);this.elements.tableBody=$("<tbody></tbody>").appendTo(this.elements.table);this._createTableHeader(this.options.columns);this.options.dataProvider!=
null&&this._updateData()},_createTableHeader:function(a){tr=$("<tr></tr>");for(var b in a)this._createHeaderCell(tr,b,a[b]).appendTo(tr);tr.appendTo(this.elements.tableHead)},_createHeaderCell:function(a,b,c){var e=$("<th></th>");e.addClass("col"+b);e.addClass("header");e.attr("data-field",c.field);if(c.customHeaderAttributes!=null)try{e.attr(c.customHeaderAttributes)}catch(d){console.log(d)}var f=null;if(c.headerRenderer!=null)f=c.headerRenderer;else if(this.options.headerRenderer!=null)f=this.options.headerRenderer;
if(f!=null){a={listData:{owner:this,data:null,column:c,index:b,th:e,tr:a}};c.itemRendererOptions!=null&&jQuery.extend(a,c.headerOptions);e[f](a)}else e.html(c.label);c.headerAttr!=null&&e.attr(c.headerAttr);c.headerStyle!=null&&this._applyStyle(e,c.headerStyle);if(c.width!=null)try{e.css("width",c.width)}catch(g){console.log(g)}c.visible==false&&e.hide();return e},_updateData:function(){$(this.elements.tableBody).children().remove();var a=this.options.dataProvider,b;for(b in a){var c=a[b],e=this._buildRow(b,
c,this.elements.tableBody),d;for(d in this.options.columns){var f=this._buildCell(e,b,d,c,this.options.columns[d]);e.append(f)}}},_buildRow:function(a,b,c){c=$("<tr></tr>").appendTo(c);var e=this._guid();c.attr("data-uid",e);this.options.rowFunction!=null&&this.options.rowFunction(c,a,b);return c},_buildCell:function(a,b,c,e,d){var f=$("<td></td>");f.addClass("col"+c);f.addClass("column");f.attr("data-field",d.field);this._applyStyle(f,d.style);if(d.customAttributes!=null)try{f.attr(d.customAttributes)}catch(g){console.log(g)}c=
this._assignlabelData(e,d);d.visible==false&&f.hide();if(d.itemRenderer!=null||d.rendererFunction!=null){a={data:c,listData:{owner:this,data:e,column:d,index:b,td:f,tr:a}};d.itemRendererOptions!=null&&jQuery.extend(a,d.itemRendererOptions);if(d.itemRenderer!=null)f[d.itemRenderer](a);else d.rendererFunction!=null&&d.rendererFunction(f,a)}else f.html(c);typeof c=="string"&&d.showToolTip==true&&f.attr("title",c);d.styleFunction!=null&&d.styleFunction(f,b,e,d);return f},_assignlabelData:function(a,b){if(b.labelFunction!=
null)return b.labelFunction(a,b);if(b.labelField!=null)return a[b.field][b.labelField];if(a[b.field]!=null)return a[b.field];return""},_setOption:function(a,b){switch(a){case "dataProvider":this.options.dataProvider=b;this._updateData();break;case "columns":this.options.columns=b;this._updateData()}$.Widget.prototype._setOption.apply(this,arguments)},showLoading:function(){this.elements.table.addClass("loading");this.elements.tableBody.animate({opacity:0.1},200)},hideLoading:function(){this.elements.table.removeClass("loading");
this.elements.tableBody.animate({opacity:1},200)},_applyStyle:function(a,b){a==null||b==null||(typeof b=="string"?a.addClass(b):a.css(b))},_guid:function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},destroy:function(){$.Widget.prototype.destroy.apply(this,arguments);this.element.removeClass("ui-grid");this.elements.table.remove();delete this.elements.table;delete this.elements.tableBody;delete this.elements.tableHead}});
